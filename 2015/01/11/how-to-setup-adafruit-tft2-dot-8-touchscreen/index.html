<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>adafruitのTFT2.8液晶セットアップ方法 &middot; kamatari</title>
        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.15" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="http://kamatari.github.io/css/normalize.css">
        <link rel="stylesheet" href="http://kamatari.github.io/css/highlight.css">
        <link rel="stylesheet" href="http://kamatari.github.io/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41886618-2', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Lifering" href="http://kamatari.github.io/">Lifering</a>
                            </h1>
                        
                        <a class="button-square" href="http://kamatari.github.io/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/iratamak">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/kamatari">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/about/">About</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">adafruitのTFT2.8液晶セットアップ方法</h1>
    
</header>

        <div class="post-content clearfix">
    

    

<h1 id="これ:768e8da07cec207a6c75c94a4ab24819">これ</h1>

<p>すごくいいです。
<div class="amazlet-box" style="margin-bottom:0px;"><div class="amazlet-image" style="float:left;margin:0px 12px 1px 0px;"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00KD6X7OW/kamiki-22/ref=nosim/" name="amazletlink" target="_blank"><img src="http://ecx.images-amazon.com/images/I/51zgGzvmZ6L._SL160_.jpg" alt="Raspberry Pi用2.8インチ　TFTモニタ特別セット" style="border: none;" /></a></div><div class="amazlet-info" style="line-height:120%; margin-bottom: 10px"><div class="amazlet-name" style="margin-bottom:10px;line-height:120%"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00KD6X7OW/kamiki-22/ref=nosim/" name="amazletlink" target="_blank">Raspberry Pi用2.8インチ　TFTモニタ特別セット</a><div class="amazlet-powered-date" style="font-size:80%;margin-top:5px;line-height:120%">posted with <a href="http://www.amazlet.com/" title="amazlet" target="_blank">amazlet</a> at 15.01.11</div></div><div class="amazlet-detail">TechShare <br />売り上げランキング: 5,355<br /></div><div class="amazlet-sub-info" style="float: left;"><div class="amazlet-link" style="margin-top: 5px"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00KD6X7OW/kamiki-22/ref=nosim/" name="amazletlink" target="_blank">Amazon.co.jpで詳細を見る</a></div></div></div><div class="amazlet-footer" style="clear: left"></div></div></p>

<h1 id="おもな素晴らしいところ:768e8da07cec207a6c75c94a4ab24819">おもな素晴らしいところ</h1>

<ul>
<li>raspberry piに供給してる電源から、液晶の電源もとれる(電源ひとつだけでok)</li>
<li>HDMIをつなげなくても、raspberrypiのconsole画面を見ることができる</li>
<li>物理的なボタンでshutdown/bootができるようになる</li>
</ul>

<h1 id="動かすまでに最低限ひつようなこと:768e8da07cec207a6c75c94a4ab24819">動かすまでに最低限ひつようなこと</h1>

<ol>
<li>液晶とGPIOピンヘッダのハンダ付け</li>
<li>raspberrypiでソフトウェアのセットアップ</li>
</ol>

<p>(追記: resistiveタイプとcapacitiveタイプで設定方法違うので注意)</p>

<h2 id="ソフトのsetup方法はふたつある:768e8da07cec207a6c75c94a4ab24819">ソフトのsetup方法はふたつある</h2>

<h3 id="その1-installerを落としてきて実行:768e8da07cec207a6c75c94a4ab24819">その1 installerを落としてきて実行</h3>

<p>以下コマンドでインストールできる。最後に、raspiを起動した時に液晶にconsole画面を表示するかと、取り付けたボタンでshutdownするか聞かれる。</p>

<pre><code class="language-bash">$ wget http://adafru.it/pitftsh
$ mv pitftsh pitft.sh
$ chmod +x pitft.sh
$ sudo ./pitft.sh -t 28r -r  #resistiveタイプ
$ sudo ./pitft.sh -t 28c -r  #capacitiveタイプ
$ sudo reboot
</code></pre>

<p>以上。<a href="https://learn.adafruit.com/adafruit-pitft-28-inch-resistive-touchscreen-display-raspberry-pi/easy-install">公式サイトの説明はこちら</a></p>

<h3 id="その2-真心を込めたコマンド手入力で設定:768e8da07cec207a6c75c94a4ab24819">その2 真心を込めたコマンド手入力で設定</h3>

<p>心を込めたい(細かい設定がしたい)方はこちらで。</p>

<p>必要なdebファイルを落としてくる。</p>

<pre><code class="language-bash">$ cd ~
$ wget http://adafruit-download.s3.amazonaws.com/libraspberrypi-bin-adafruit.deb
$ wget http://adafruit-download.s3.amazonaws.com/libraspberrypi-dev-adafruit.deb
$ wget http://adafruit-download.s3.amazonaws.com/libraspberrypi-doc-adafruit.deb
$ wget http://adafruit-download.s3.amazonaws.com/libraspberrypi0-adafruit.deb
$ wget http://adafruit-download.s3.amazonaws.com/raspberrypi-bootloader-adafruit-20140917-1.deb
</code></pre>

<p>インストール</p>

<pre><code class="language-bash">$ sudo dpkg -i -B *.deb
</code></pre>

<p>2013年の9月に出たバージョンより新しいraspbian使ってる人は、99-fbturbo.confを動かしとく必要がある</p>

<pre><code class="language-bash">$ sudo mv /usr/share/X11/xorg.conf.d/99-fbturbo.conf ~
</code></pre>

<p>再起動</p>

<pre><code class="language-bash">$ sudo reboot
</code></pre>

<p>moduleを入れて、xwindowを起動してtft液晶に表示 (※追記 resistiveタイプとcapacitiveタイプでmoduleが違う）</p>

<ul>
<li><p>resistiveタイプ</p>

<pre><code class="language-bash">$ sudo modprobe spi-bcm2708
$ sudo modprobe fbtft_device name=adafruitts rotate=90
$ export FRAMEBUFFER=/dev/fb1
$ startx
</code></pre></li>

<li><p>capacitiveタイプ(※追記)</p>

<pre><code class="language-bash">$ sudo modprobe spi-bcm2708
$ sudo modprobe i2c-bcm2708
$ sudo modprobe fbtft_device name=adafruitct28 rotate=90
$ export FRAMEBUFFER=/dev/fb1
$ startx
</code></pre>

<p>表示されたら成功。さきほどのmoduleを毎回起動するコマンドを打たなくて済むように、etc modulesを編集</p></li>

<li><p>resistiveタイプ</p>

<pre><code class="language-bash">$ sudo vim /etc/modules
spi-bcm2708
fbtft_device
</code></pre></li>

<li><p>capacitiveタイプ (※追記)</p>

<pre><code class="language-bash">$ sudo vim /etc/modules
i2c-bcm2708
spi-bcm2708
fbtft_device
</code></pre></li>
</ul>

<p>modprobe fileを作って、設定を書く。そして再起動</p>

<pre><code class="language-bash">$ sudo vim /etc/modprobe.d/adafruit.conf
options fbtft_device name=adafruitrt28 rotate=90 frequency=32000000
$ sudo reboot
</code></pre>

<h4 id="touchscreenのcallibration用のファイル作成:768e8da07cec207a6c75c94a4ab24819">touchscreenのcallibration用のファイル作成</h4>

<ul>
<li>resistiveタイプ
``` bash
$ sudo mkdir /etc/X11/xorg.conf.d
$ sudo vim /etc/X11/xorg.conf.d/99-calibration.conf</li>
</ul>

<p>Section &ldquo;InputClass&rdquo;
        Identifier      &ldquo;calibration&rdquo;
        MatchProduct    &ldquo;stmpe-ts&rdquo;
        Option  &ldquo;Calibration&rdquo;   &ldquo;3800 200 200 3800&rdquo;
        Option  &ldquo;SwapAxes&rdquo;      &ldquo;1&rdquo;
EndSection</p>

<pre><code>
+ capacitiveタイプ (※追記)
``` bash
$ sudo mkdir /etc/X11/xorg.conf.d
$ sudo vim /etc/X11/xorg.conf.d/99-captouch.conf

Section &quot;InputClass&quot;
         Identifier &quot;captouch&quot;
         MatchProduct &quot;ft6x06_ts&quot;
         Option &quot;SwapAxes&quot; &quot;1&quot;
         Option &quot;InvertY&quot; &quot;1&quot;
         Option &quot;Calibration&quot; &quot;0 320 0 240&quot;
EndSection
</code></pre>

<p>xwindowを液晶で見るために毎回FRAMEBUFFERをexportしなくてすむように設定を追記</p>

<pre><code class="language-bash">$ sudo vim ~/.profile
export FRAMEBUFFER=/dev/fb1
</code></pre>

<h4 id="ここからtouchscreenの設定:768e8da07cec207a6c75c94a4ab24819">ここからtouchscreenの設定</h4>

<ul>
<li>resistiveタイプ
<code>bash
$ sudo vim /etc/udev/rules.d/95-stmpe.rules
SUBSYSTEM==&quot;input&quot;, ATTRS{name}==&quot;stmpe-ts&quot;, ENV{DEVNAME}==&quot;*event*&quot;, SYMLINK+=&quot;input/touchscreen&quot;
</code>
module stmpe_tsをremoveして再install</li>
</ul>

<pre><code class="language-bash">$ sudo rmmod stmpe_ts; sudo modprobe stmpe_ts
</code></pre>

<p>touchscreenができていることを確認 (うまく起動出来てないと、存在しない)</p>

<pre><code class="language-bash">$ ls -l /dev/input/touchscreen
drwxrwxrwx  1 root  root 6 Nov 12 27 15:04 /dev/input/touchscreen -&gt; event2
</code></pre>

<ul>
<li>capacitiveタイプ(※追記)
<code>bash
$ sudo vim /etc/udev/rules.d/95-ft6206.rules
SUBSYSTEM==&quot;input&quot;, ATTRS{name}==&quot;ft6x06_ts&quot;, ENV{DEVNAME}==&quot;*event*&quot;, SYMLINK+=&quot;input/touchscreen&quot;
</code>
capacitiveタイプでは、module <code>ft6x06_ts</code>を使う
<code>bash
$ sudo rmmod ft6x06_ts; sudo modprobe ft6x06_ts
</code></li>
</ul>

<h4 id="touchscreenをテストしてみる:768e8da07cec207a6c75c94a4ab24819">touchscreenをテストしてみる</h4>

<p>test用のmoduleをinstallして、実際にタッチしてみると入力が確認出来る</p>

<pre><code class="language-bash">$ sudo apt-get install evtest tslib libts-bin
$ sudo evtest /dev/input/touchscreen
</code></pre>

<p>rotationを変えたりした後、callibrationを自動で行うためのツールがある</p>

<pre><code class="language-bash">$ wget https://github.com/adafruit/PiTFT_Extras/raw/master/pitft_touch_cal.py
$ sudo mkdir /etc/X11/xorg.conf.d/
$ chmod +x pitft_touch_cal.py
$ sudo ./pitft_touch_cal.py
</code></pre>

<p>manualで設定するcallibrationツールを利用することも出来る</p>

<pre><code class="language-bash">$ sudo TSLIB_FBDEVICE=/dev/fb1 TSLIB_TSDEVICE=/dev/input/touchscreen ts_calibrate
</code></pre>

<p>touchscreenを使って線を描画するテストができる</p>

<pre><code class="language-bash">$ sudo TSLIB_FBDEVICE=/dev/fb1 TSLIB_TSDEVICE=/dev/input/touchscreen ts_test
</code></pre>

<p>以上。<a href="https://learn.adafruit.com/adafruit-pitft-28-inch-resistive-touchscreen-display-raspberry-pi/software-installation">公式のスクリーンショット付き説明</a></p>

<h1 id="はまったところ:768e8da07cec207a6c75c94a4ab24819">はまったところ</h1>

<ul>
<li>液晶は表示出来るけど、touchscreenが反応しない</li>
</ul>

<p>dmesgでだめっぽいの出てる。</p>

<pre><code class="language-bash"> $ dmesg |grep stmpe-spi
[   12.464470] stmpe-spi spi0.1: unknown chip id: 0x0
[   12.482715] stmpe-spi: probe of spi0.1 failed with error_log(' ' . var_export(, true)) -22
</code></pre>

<p>installer を使わずにやっていると、stmpe_tsをremoveしようとした時に、not currently loadedと言われる。これは、stmpeが動いてないからぽい。</p>

<pre><code class="language-bash">$ sudo rmmod stmpe_ts; sudo modprobe stmpe_ts
Error: Module stmpe_ts is not currently loaded
</code></pre>

<h2 id="解決編:768e8da07cec207a6c75c94a4ab24819">解決編</h2>

<p>いろいろ試してうまくいかず、きっとこれ不良品だなadafruitめ！と思ったが、なんのことはなかった。
このtft2.8サイズの液晶には、静電容量方式のタッチパネルと、加圧を検知する抵抗膜方式のタッチパネルの2種類が存在したのだ。知らなかった。そして、当然セットアップ方法が違う。正しく公式サイトの手順通りに設定したら、きちんとtouchscreen動きました。</p>

<p>adafruit 最高っス！</p>

<h3 id="公式サイト:768e8da07cec207a6c75c94a4ab24819">公式サイト</h3>

<ul>
<li><p>静電容量方式のセットアップ (capacitive touchscreen)</p>

<ul>
<li><a href="https://learn.adafruit.com/adafruit-2-8-pitft-capacitive-touch/software-install">adafruit-2-8-pitft-capacitive-touchscreen</a></li>
</ul></li>

<li><p>抵抗膜方式のセットアップ(resistive touchscreen)</p>

<ul>
<li><a href="https://learn.adafruit.com/adafruit-pitft-28-inch-resistive-touchscreen-display-raspberry-pi/software-installation">adafruit-pitft-28-inch-resistive-touchscreen</a></li>
</ul></li>
</ul>

<p>このブログの記事をさかのぼって、capacitiveの時の設定方法を追記しておいた。</p>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        <a class="icon-twitter" href="http://twitter.com/share?text=adafruit%e3%81%aeTFT2.8%e6%b6%b2%e6%99%b6%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e6%96%b9%e6%b3%95&url=http%3a%2f%2fkamatari.github.io%2f2015%2f01%2f11%2fhow-to-setup-adafruit-tft2-dot-8-touchscreen%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fkamatari.github.io%2f2015%2f01%2f11%2fhow-to-setup-adafruit-tft2-dot-8-touchscreen%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2fkamatari.github.io%2f2015%2f01%2f11%2fhow-to-setup-adafruit-tft2-dot-8-touchscreen%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Lifering" href="http://kamatari.github.io/">Lifering</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2016 / Powered by <a href="http://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="http://kamatari.github.io/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="http://kamatari.github.io/js/jquery.fitvids.js"></script>
        <script src="http://kamatari.github.io/js/scripts.js"></script>
    </body>
</html>

